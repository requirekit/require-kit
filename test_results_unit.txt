============================= test session starts ==============================
platform darwin -- Python 3.12.4, pytest-8.4.2, pluggy-1.6.0 -- /Users/richardwoollcott/Projects/appmilla_github/ai-engineer/.venv/bin/python3.12
cachedir: .pytest_cache
rootdir: /Users/richardwoollcott/Projects/appmilla_github/ai-engineer
configfile: pytest.ini
plugins: mock-3.15.1, cov-7.0.0
collecting ... collected 46 items

tests/unit/test_plan_modifier.py::TestModificationCategory::test_category_values PASSED [  2%]
tests/unit/test_plan_modifier.py::TestModificationCategory::test_display_names PASSED [  4%]
tests/unit/test_plan_modifier.py::TestModificationRecord::test_record_creation PASSED [  6%]
tests/unit/test_plan_modifier.py::TestModificationRecord::test_record_str_representation PASSED [  8%]
tests/unit/test_plan_modifier.py::TestModificationSession::test_session_creation PASSED [ 10%]
tests/unit/test_plan_modifier.py::TestModificationSession::test_has_modifications_property PASSED [ 13%]
tests/unit/test_plan_modifier.py::TestPlanModifier::test_initialization PASSED [ 15%]
tests/unit/test_plan_modifier.py::TestPlanModifier::test_initialization_with_invalid_task PASSED [ 17%]
tests/unit/test_plan_modifier.py::TestPlanModifier::test_run_interactive_session_plan_not_found PASSED [ 19%]
tests/unit/test_plan_modifier.py::TestPlanModifier::test_run_interactive_session_load_error PASSED [ 21%]
tests/unit/test_plan_modifier.py::TestPlanModifier::test_get_user_choice_normal_input PASSED [ 23%]
tests/unit/test_plan_modifier.py::TestPlanModifier::test_get_user_choice_keyboard_interrupt PASSED [ 26%]
tests/unit/test_plan_modifier.py::TestPlanModifier::test_get_user_choice_eof_error PASSED [ 28%]
tests/unit/test_plan_modifier.py::TestFileModifications::test_add_file_to_create PASSED [ 30%]
tests/unit/test_plan_modifier.py::TestFileModifications::test_add_file_empty_path PASSED [ 32%]
tests/unit/test_plan_modifier.py::TestFileModifications::test_add_duplicate_file PASSED [ 34%]
tests/unit/test_plan_modifier.py::TestFileModifications::test_remove_file_valid PASSED [ 36%]
tests/unit/test_plan_modifier.py::TestFileModifications::test_remove_file_cancel PASSED [ 39%]
tests/unit/test_plan_modifier.py::TestFileModifications::test_remove_file_invalid_number PASSED [ 41%]
tests/unit/test_plan_modifier.py::TestFileModifications::test_remove_file_from_empty_list PASSED [ 43%]
tests/unit/test_plan_modifier.py::TestDependencyModifications::test_add_dependency_full_info PASSED [ 45%]
tests/unit/test_plan_modifier.py::TestDependencyModifications::test_add_dependency_name_only PASSED [ 47%]
tests/unit/test_plan_modifier.py::TestDependencyModifications::test_add_dependency_empty_name PASSED [ 50%]
tests/unit/test_plan_modifier.py::TestDependencyModifications::test_remove_dependency_valid PASSED [ 52%]
tests/unit/test_plan_modifier.py::TestRiskModifications::test_add_risk_full_info PASSED [ 54%]
tests/unit/test_plan_modifier.py::TestRiskModifications::test_add_risk_default_severity PASSED [ 56%]
tests/unit/test_plan_modifier.py::TestRiskModifications::test_add_risk_invalid_severity PASSED [ 58%]
tests/unit/test_plan_modifier.py::TestRiskModifications::test_add_risk_empty_description PASSED [ 60%]
tests/unit/test_plan_modifier.py::TestRiskModifications::test_remove_risk_valid PASSED [ 63%]
tests/unit/test_plan_modifier.py::TestRiskModifications::test_modify_risk_severity PASSED [ 65%]
tests/unit/test_plan_modifier.py::TestRiskModifications::test_modify_risk_mitigation PASSED [ 67%]
tests/unit/test_plan_modifier.py::TestEffortModifications::test_modify_effort_all_fields PASSED [ 69%]
tests/unit/test_plan_modifier.py::TestEffortModifications::test_modify_effort_keep_current_values PASSED [ 71%]
tests/unit/test_plan_modifier.py::TestEffortModifications::test_modify_effort_invalid_loc PASSED [ 73%]
tests/unit/test_plan_modifier.py::TestEffortModifications::test_modify_effort_invalid_complexity_range PASSED [ 76%]
tests/unit/test_plan_modifier.py::TestUndoFunctionality::test_undo_no_modifications PASSED [ 78%]
tests/unit/test_plan_modifier.py::TestUndoFunctionality::test_undo_file_addition PASSED [ 80%]
tests/unit/test_plan_modifier.py::TestUndoFunctionality::test_undo_file_removal PASSED [ 82%]
tests/unit/test_plan_modifier.py::TestUndoFunctionality::test_undo_dependency_addition PASSED [ 84%]
tests/unit/test_plan_modifier.py::TestUndoFunctionality::test_undo_effort_modification PASSED [ 86%]
tests/unit/test_plan_modifier.py::TestFinalization::test_finalize_no_modifications PASSED [ 89%]
tests/unit/test_plan_modifier.py::TestFinalization::test_finalize_with_modifications_confirmed FAILED [ 91%]
tests/unit/test_plan_modifier.py::TestFinalization::test_finalize_with_modifications_cancelled PASSED [ 93%]
tests/unit/test_plan_modifier.py::TestFinalization::test_finalize_save_error PASSED [ 95%]
tests/unit/test_plan_modifier.py::TestModificationWorkflows::test_multiple_modifications_workflow PASSED [ 97%]
tests/unit/test_plan_modifier.py::TestModificationWorkflows::test_modification_with_multiple_undos PASSED [100%]

=================================== FAILURES ===================================
_________ TestFinalization.test_finalize_with_modifications_confirmed __________
installer/global/commands/lib/plan_modifier.py:1057: in _finalize_modifications
    from .plan_persistence import save_plan_version
E   ImportError: attempted relative import with no known parent package

The above exception was the direct cause of the following exception:
tests/unit/test_plan_modifier.py:628: in test_finalize_with_modifications_confirmed
    result = modifier._finalize_modifications()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
installer/global/commands/lib/plan_modifier.py:1070: in _finalize_modifications
    raise PlanModificationError(f"Failed to save plan: {e}") from e
E   plan_modifier.PlanModificationError: Failed to save plan: attempted relative import with no known parent package
----------------------------- Captured stdout call -----------------------------

âœ“ Added 'src/test_file.py' to files to create

============================================================
Modification Summary
============================================================

Total Modifications: 1
  - FILES: add - Added src/test_file.py to create

------------------------------ Captured log call -------------------------------
ERROR    plan_modifier:plan_modifier.py:1069 Failed to save modified plan: attempted relative import with no known parent package
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.12.4-final-0 _______________

Name                                                    Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------------------
installer/global/commands/lib/plan_modifier.py            500    193    182     23    57%   25, 177-204, 240-268, 296-307, 336-386, 463-464, 488-522, 549-550, 575-576, 587, 606-608, 634-679, 735-736, 744, 751, 762, 775-777, 787-788, 796, 803, 812-813, 845-847, 913-915, 970->1010, 972->1010, 976->1010, 982->1010, 984-986, 989-1001, 1003->1010, 1005->1010, 1058-1066
installer/global/lib/__init__.py                            0      0      0      0   100%
installer/global/lib/config/__init__.py                     4      4      0      0     0%   2-6
installer/global/lib/config/config_schema.py               58     58      8      0     0%   2-117
installer/global/lib/config/defaults.py                     2      2      0      0     0%   2-5
installer/global/lib/config/plan_review_config.py         120    120     50      0     0%   2-297
installer/global/lib/metrics/__init__.py                    3      3      0      0     0%   2-5
installer/global/lib/metrics/metrics_storage.py            80     80     24      0     0%   2-164
installer/global/lib/metrics/plan_review_dashboard.py     133    133     52      0     0%   2-264
installer/global/lib/metrics/plan_review_metrics.py        33     33      8      0     0%   2-197
installer/global/lib/utils/__init__.py                      4      4      0      0     0%   2-6
installer/global/lib/utils/file_operations.py              51     51      2      0     0%   2-117
installer/global/lib/utils/json_serializer.py              36     36      2      0     0%   2-97
installer/global/lib/utils/path_resolver.py                28     28      6      0     0%   2-81
---------------------------------------------------------------------------------------------------
TOTAL                                                    1052    745    334     23    28%
Coverage JSON written to file coverage_task029_unit.json
=========================== short test summary info ============================
FAILED tests/unit/test_plan_modifier.py::TestFinalization::test_finalize_with_modifications_confirmed - plan_modifier.PlanModificationError: Failed to save plan: attempted relative import with no known parent package
========================= 1 failed, 45 passed in 0.30s =========================
